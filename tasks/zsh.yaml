---

- name: set zsh as default shell
  become: true
  user:
    name: "{{ username }}"
    shell: /usr/bin/zsh

- name: create zsh dir in XDG_CONFIG_HOME
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config/zsh"
    state: directory
    owner: "{{ username }}"
    group: "{{ group }}"
    mode: '0700'

- name: "symlink zsh files"
  ansible.builtin.file:
    dest: "{{ ansible_env.HOME }}/.config/zsh/{{ item }}"
    src: "{{ ansible_env.PWD }}/files/zsh/{{ item }}"
    owner: "{{ username }}"
    group: "{{ group }}"
    state: link
    mode: '0770'
  when: ansible_facts["env"]["PWD"] is match(".*/workstation$")
  loop:
    - .zshrc
    - zsh-functions
    - zsh-aliases
    - zsh-exports
    - zsh-prompt

- name: copy export file with encrypted content
  become: true
  vars:
    ldap_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      39643362313838323264613464623434376331323638616430316530623261653930636136333264
      3730393034333633326435303433623336353735306639610a363133323964636539353030356662
      62373438613836353735636639653133663839383930666333653462646164616638646264303537
      3763333132343537650a353831663330313664386461626330373935323965303132353831373739
      6163
    ldap_pass: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61343832396434333563316232306234653533343666633263656631653539303331633137663661
      3938626361613261353334646238666635316430393362360a386138663733363234373333323532
      30626134666431396632636235653735616532663662316264343765623534656231633635663965
      6662653737663139370a373663666434303235623233336565376263633263643065303366356535
      61386266386436316265363430356562396235333338356535306365616666323632
    bitbucket_url: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34306462613139653262636564373562343831633732326136353530316662633339323336376538
      3135396435343437616537343039386439623662386333650a626238393565333330646364656364
      65643261663137396238343663336539636262653533383234323237323833656463626530383937
      3530336565626361300a366463633932636538653665353931646462333733306434616537626639
      65613763393137346232353963326661353363306565646530306532653538653136336632663764
      3366376462323265333238383461646466663636303830316135
    harbor_user_q: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65323666346266636361653165613031306439373962366234623934633665643838326633353962
      3664396363626464386231376632383534613761306638620a616537646261306632393035313133
      63356232303936633133313835633561616365393065623365353862306330646635643230323132
      3336663233653735380a343263383939353061396261633531646233353231396335316439656430
      64343132636336353438646463353834343239333636613964623335653763666537
    harbor_pass_q: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      64343363303563613365643961353037663934306637303137666537633964633131343539666431
      3337336164666639376261633235336636626564343465610a376536333533663762313032393934
      66343838333836336136333434313030613737623534356632393037333361316463313330393034
      6539333235386136350a616566356365373666643837343562346436646462393933643430363062
      34303565346333626138616137636366303763653533623433363432366234663733356661626361
      3237303339376665343365306437323639643130616334656538
  ansible.builtin.template:
    src: files/zsh/zsh-exports-enc
    dest: "{{ ansible_env.HOME }}/.config/zsh"
    owner: "{{ username }}"
    group: "{{ group }}"
    mode: '0600'