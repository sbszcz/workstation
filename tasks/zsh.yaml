---

- name: set zsh as default shell
  become: true
  user:
    name: "{{ username }}"
    shell: /usr/bin/zsh

- name: create zsh dir in XDG_CONFIG_HOME
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config/zsh"
    state: directory
    owner: "{{ username }}"
    group: "{{ group }}"
    mode: '0700'

- name: "symlink zsh files"
  ansible.builtin.file:
    dest: "{{ ansible_env.HOME }}/.config/zsh/{{ item }}"
    src: "{{ ansible_env.PWD }}/files/zsh/{{ item }}"
    owner: "{{ username }}"
    group: "{{ group }}"
    state: link
    mode: '0770'
  when: ansible_facts["env"]["PWD"] is match(".*/workstation$")
  loop:
    - .zshrc
    - zsh-functions
    - zsh-aliases
    - zsh-exports
    - zsh-prompt

- name: copy export file with encrypted content
  become: true
  vars:
    ldap_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      39643362313838323264613464623434376331323638616430316530623261653930636136333264
      3730393034333633326435303433623336353735306639610a363133323964636539353030356662
      62373438613836353735636639653133663839383930666333653462646164616638646264303537
      3763333132343537650a353831663330313664386461626330373935323965303132353831373739
      6163
    ldap_pass: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61343832396434333563316232306234653533343666633263656631653539303331633137663661
      3938626361613261353334646238666635316430393362360a386138663733363234373333323532
      30626134666431396632636235653735616532663662316264343765623534656231633635663965
      6662653737663139370a373663666434303235623233336565376263633263643065303366356535
      61386266386436316265363430356562396235333338356535306365616666323632
    bitbucket_url: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34306462613139653262636564373562343831633732326136353530316662633339323336376538
      3135396435343437616537343039386439623662386333650a626238393565333330646364656364
      65643261663137396238343663336539636262653533383234323237323833656463626530383937
      3530336565626361300a366463633932636538653665353931646462333733306434616537626639
      65613763393137346232353963326661353363306565646530306532653538653136336632663764
      3366376462323265333238383461646466663636303830316135
    harbor_qhcr_url: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31393430313939656163373564336164313139636264346632623936663964363830383235373632
      3233656462353566653565306530393366373834333133320a376535656637653234313963646438
      32366537373135373932316438636239646136653963306461613239636235626630323266393331
      3661323437383766340a643565306335613764626637356131363037623335383137643661363935
      31656663633461316433633534333865623061616330343136356664323064363765623163353434
      3736346562663564623433303934333934626138323264333531
    harbor_user_q: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65663362643037313430333766316531623038653734343139633063333838323236306535326564
      3065303465386235323233346132663361373566343731380a306536626632623630663863316639
      62346638333939386365663439323432373364343030313635653439313630653531313333353061
      3530646530333038360a656661323332656230616136333563626465366337653836363637303133
      39633733623963306236363635663339623737663830666239303466316530643565373136313231
      3038303765613633383765613038333739663230633030616436
    harbor_pass_q: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61616165313930363163643065313132323035366237323937613930316265323663323633353566
      3761323963653761386664313165623966303831353239660a643362333635613230343234343730
      30643930333638666430663266376162366161616534393135613530336465343832663732393432
      3938663965323732370a613764326335393837383061663135323638383833343163626464333166
      35613936353730353434646637333666663637666639383234313663323166336464336336306538
      6537663739323133323036363136653433666232633432376634
    srv_sdb_artifactory: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      62636337393066663766323734376134323365383366346137333834383834656131613337646463
      3235333664326161633234623134323336633133646636340a653166363932633733653465383332
      64663134653539663064663933653039363065626361613033363337623661616636373238333965
      3035396131393838630a663762396366613139336238396330316566653035326132633761396266
      39373234623731313833386239353462323062653233623537373239306336663963
  ansible.builtin.template:
    src: files/zsh/zsh-exports-enc
    dest: "{{ ansible_env.HOME }}/.config/zsh"
    owner: "{{ username }}"
    group: "{{ group }}"
    mode: '0600'
