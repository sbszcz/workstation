---
- name: set zsh as default shell
  become: true
  user:
    name: "{{ username }}"
    shell: /usr/bin/zsh

- name: create zsh dir in XDG_CONFIG_HOME
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config/zsh"
    state: directory
    owner: "{{ username }}"
    group: "{{ group }}"
    mode: "0700"

- name: "symlink zsh files"
  ansible.builtin.file:
    dest: "{{ ansible_env.HOME }}/.config/zsh/{{ item }}"
    src: "{{ ansible_env.PWD }}/files/zsh/{{ item }}"
    owner: "{{ username }}"
    group: "{{ group }}"
    state: link
    mode: "0770"
  when: ansible_facts["env"]["PWD"] is match(".*/workstation$")
  loop:
    - .zshrc
    - zsh-functions
    - zsh-aliases
    - zsh-exports
    - zsh-prompt

- name: "symlink starship.toml"
  ansible.builtin.file:
    dest: "{{ ansible_env.HOME }}/.config/starship.toml"
    src: "{{ ansible_env.PWD }}/files/starship/starship.toml"
    owner: "{{ username }}"
    group: "{{ group }}"
    state: link
    mode: "0770"
  when: ansible_facts["env"]["PWD"] is match(".*/workstation$")

- name: copy export file with encrypted content
  become: true
  vars:
    ldap_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      39643362313838323264613464623434376331323638616430316530623261653930636136333264
      3730393034333633326435303433623336353735306639610a363133323964636539353030356662
      62373438613836353735636639653133663839383930666333653462646164616638646264303537
      3763333132343537650a353831663330313664386461626330373935323965303132353831373739
      6163
    ldap_pass: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      37343234626638623539393932633862343632636631393764306561336161366235363163656166
      3338666262613337613262333061383835363530353633390a656461636131366531343663303364
      61653166633034323365343139343630353638393262643232626636646465613463653139316663
      3465616236386465630a383139643035343732333335333439613936376465386461333534623563
      31633733303361643436663734623164353863633435336566363230613032393766
    bitbucket_url: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34306462613139653262636564373562343831633732326136353530316662633339323336376538
      3135396435343437616537343039386439623662386333650a626238393565333330646364656364
      65643261663137396238343663336539636262653533383234323237323833656463626530383937
      3530336565626361300a366463633932636538653665353931646462333733306434616537626639
      65613763393137346232353963326661353363306565646530306532653538653136336632663764
      3366376462323265333238383461646466663636303830316135
    harbor_qhcr_url: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31393430313939656163373564336164313139636264346632623936663964363830383235373632
      3233656462353566653565306530393366373834333133320a376535656637653234313963646438
      32366537373135373932316438636239646136653963306461613239636235626630323266393331
      3661323437383766340a643565306335613764626637356131363037623335383137643661363935
      31656663633461316433633534333865623061616330343136356664323064363765623163353434
      3736346562663564623433303934333934626138323264333531
    harbor_user_q: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65663362643037313430333766316531623038653734343139633063333838323236306535326564
      3065303465386235323233346132663361373566343731380a306536626632623630663863316639
      62346638333939386365663439323432373364343030313635653439313630653531313333353061
      3530646530333038360a656661323332656230616136333563626465366337653836363637303133
      39633733623963306236363635663339623737663830666239303466316530643565373136313231
      3038303765613633383765613038333739663230633030616436
    harbor_pass_q: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61616165313930363163643065313132323035366237323937613930316265323663323633353566
      3761323963653761386664313165623966303831353239660a643362333635613230343234343730
      30643930333638666430663266376162366161616534393135613530336465343832663732393432
      3938663965323732370a613764326335393837383061663135323638383833343163626464333166
      35613936353730353434646637333666663637666639383234313663323166336464336336306538
      6537663739323133323036363136653433666232633432376634
    artifactory_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      37656239333762326431626233393737303863383736623639323966656332386131663661306535
      3863333564623561396433393466623566636663333231330a343931336530376630363639363565
      31643763363566636138616162346235316237646666653664376638643832333936373639333835
      3262356666653561620a346436383162633662653138643938363132623235616363393465333938
      3263
    artifactory_token: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      64376130303162336364616139393066393562393432613731326134383431393739363036653536
      3532303363633631363435333464303436633534656537320a373561376161663964386438306163
      38623531633637643835346330313231343861653533663361353266393530623362636431376633
      3561313231303462300a366138633562623835316164623337323537343834376233346136663362
      39346163653836666363363261333137346437326161626637333836643837366436623132343033
      35313937636239313236303866616234386364383131336638396434303935313961343237626230
      64326665663861616261393238363838653238363232386339323330653265336233633832323966
      31373165366432616239
  ansible.builtin.template:
    src: files/zsh/zsh-exports-enc
    dest: "{{ ansible_env.HOME }}/.config/zsh"
    owner: "{{ username }}"
    group: "{{ group }}"
    mode: "0600"
